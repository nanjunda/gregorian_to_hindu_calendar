<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Samvatsara Resonance: Jupiter-Saturn Cycle</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.85);
            padding: 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            width: 240px;
            z-index: 1000;
            border: 1px solid rgba(255, 145, 0, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }

        #ui.minimized {
            width: 32px;
            height: 32px;
            padding: 0;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 145, 0, 0.15);
            border: 1px solid rgba(255, 145, 0, 0.4);
        }

        #ui.minimized .content-box {
            display: none;
        }

        #ui h3 {
            margin: 0 0 5px 0;
            color: #ff9100;
            font-size: 0.9rem;
        }

        .legend-item {
            margin: 3px 0;
            display: flex;
            align-items: center;
            font-size: 0.7rem;
        }

        .color-box {
            width: 20px;
            height: 10px;
            margin-right: 8px;
            border-radius: 2px;
        }

        .toggle-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            cursor: pointer;
            color: #ff9100;
            font-size: 1.1rem;
            font-weight: bold;
            user-select: none;
            z-index: 1001;
        }

        #ui.minimized .toggle-btn {
            position: static;
            font-size: 1.3rem;
        }

        .resonance-stat {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
            font-size: 0.65rem;
            backdrop-filter: blur(5px);
        }

        .resonance-stat .big {
            font-size: 1.4rem;
            font-weight: bold;
            display: block;
        }

        #controls-hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.65rem;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="ui" class="minimized">
        <div class="toggle-btn" onclick="toggleUI()">+</div>
        <div class="content-box">
            <h3>Samvatsara: Resonance</h3>
            <p style="font-size: 0.65rem; color: #888; margin-bottom: 8px;">Archaeoastronomy Module v6.0</p>

            <div class="legend-item">
                <div class="color-box" style="background: #ffcc80;"></div>
                <span><strong>Jupiter</strong> (~11.86y orbit)</span>
            </div>
            <div class="legend-item">
                <div class="color-box" style="background: #ce93d8;"></div>
                <span><strong>Saturn</strong> (~29.46y orbit)</span>
            </div>

            <div
                style="margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.7rem; line-height: 1.3; color: #ccc;">
                <strong style="color: #ff9100;">The 60-Year Reset:</strong><br>
                Jupiter completes 5 orbits as Saturn completes 2. This resonance is the geometric basis of the
                Samvatsara cycle!
            </div>
        </div>
    </div>

    <div class="resonance-stat">
        <span class="big">5 : 2</span>
        Resonance Ratio
    </div>

    <div id="controls-hint">
        Drag to Orbit • Scroll to Zoom
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // UI Toggle Function
        function toggleUI() {
            const ui = document.getElementById('ui');
            const toggleBtn = ui.querySelector('.toggle-btn');
            if (ui.classList.contains('minimized')) {
                ui.classList.remove('minimized');
                toggleBtn.textContent = '−';
            } else {
                ui.classList.add('minimized');
                toggleBtn.textContent = '+';
            }
        }

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        camera.position.set(0, 800, 1000);
        camera.lookAt(0, 0, 0);

        // Lighting
        scene.add(new THREE.AmbientLight(0x333333));
        const sunLight = new THREE.PointLight(0xffffff, 2, 2000);
        scene.add(sunLight);

        // Stars
        const starGeo = new THREE.BufferGeometry();
        const starPos = [];
        for (let i = 0; i < 3000; i++) {
            starPos.push((Math.random() - 0.5) * 4000, (Math.random() - 0.5) * 4000, (Math.random() - 0.5) * 4000);
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 1.5 })));

        // Sun
        const sun = new THREE.Mesh(
            new THREE.SphereGeometry(40, 32, 32),
            new THREE.MeshBasicMaterial({ color: 0xffd700 })
        );
        scene.add(sun);

        // Orbits
        function createOrbit(radius, color) {
            const curve = new THREE.EllipseCurve(0, 0, radius, radius);
            const points = curve.getPoints(128);
            const geo = new THREE.BufferGeometry().setFromPoints(points.map(p => new THREE.Vector3(p.x, 0, p.y)));
            const mat = new THREE.LineBasicMaterial({ color: color, transparent: true, opacity: 0.3 });
            return new THREE.Line(geo, mat);
        }

        const jupOrbit = createOrbit(250, 0xffcc80);
        const satOrbit = createOrbit(450, 0xce93d8);
        scene.add(jupOrbit);
        scene.add(satOrbit);

        // Planets
        const jupiter = new THREE.Mesh(
            new THREE.SphereGeometry(18, 32, 32),
            new THREE.MeshPhongMaterial({ color: 0xffcc80, shininess: 50 })
        );
        const saturn = new THREE.Mesh(
            new THREE.SphereGeometry(15, 32, 32),
            new THREE.MeshPhongMaterial({ color: 0xce93d8, shininess: 50 })
        );

        // Saturn Rings
        const ringGeo = new THREE.RingGeometry(20, 35, 64);
        const ringMat = new THREE.MeshBasicMaterial({ color: 0xce93d8, side: THREE.DoubleSide, transparent: true, opacity: 0.5 });
        const rings = new THREE.Mesh(ringGeo, ringMat);
        rings.rotation.x = Math.PI / 2.5;
        saturn.add(rings);

        scene.add(jupiter);
        scene.add(saturn);

        // Conjunction Markers
        const markerGeo = new THREE.BoxGeometry(10, 2, 40);
        const markerMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.2 });
        for (let i = 0; i < 3; i++) {
            const marker = new THREE.Mesh(markerGeo, markerMat);
            const angle = (i * 120) * Math.PI / 180;
            marker.position.set(Math.cos(angle) * 350, 0, Math.sin(angle) * 350);
            marker.lookAt(0, 0, 0);
            scene.add(marker);
        }

        // Animation State
        let time = 0;
        const jupSpeed = 0.01; // Scale: 12 years
        const satSpeed = jupSpeed * (11.86 / 29.46);

        // Interaction
        let isDragging = false;
        let prevMouse = { x: 0, y: 0 };

        window.onmousedown = (e) => { isDragging = true; prevMouse = { x: e.clientX, y: e.clientY }; };
        window.onmouseup = () => isDragging = false;
        window.onmousemove = (e) => {
            if (!isDragging) return;
            const dx = (e.clientX - prevMouse.x) * 0.005;
            const dy = (e.clientY - prevMouse.y) * 0.005;
            camera.position.applyQuaternion(new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), -dx));
            camera.lookAt(0, 0, 0);
            prevMouse = { x: e.clientX, y: e.clientY };
        };
        window.onwheel = (e) => {
            camera.position.multiplyScalar(1 + e.deltaY * 0.001);
        };

        function animate() {
            requestAnimationFrame(animate);
            time += 0.5;

            // Update Positions
            const jupAngle = time * jupSpeed;
            const satAngle = time * satSpeed;

            jupiter.position.set(Math.cos(jupAngle) * 250, 0, Math.sin(jupAngle) * 250);
            saturn.position.set(Math.cos(satAngle) * 450, 0, Math.sin(satAngle) * 450);

            renderer.render(scene, camera);
        }

        animate();

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>

</html>