<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sky Focus: Nakshatra Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #05070c;
            overflow: hidden;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(13, 17, 23, 0.9);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(0, 210, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 1000;
            width: 240px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }

        #ui.minimized {
            width: 32px;
            height: 32px;
            padding: 0;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 210, 255, 0.15);
            border: 1px solid rgba(0, 210, 255, 0.4);
        }

        #ui.minimized .content-box {
            display: none;
        }

        #ui h3 {
            margin: 0 0 5px 0;
            color: #00d2ff;
            font-size: 0.9rem;
        }

        .toggle-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            cursor: pointer;
            color: #00d2ff;
            font-size: 1.1rem;
            font-weight: bold;
            user-select: none;
            z-index: 1001;
        }

        #ui.minimized .toggle-btn {
            position: static;
            font-size: 1.3rem;
        }

        .control-group {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        #view-toggle {
            background: rgba(0, 210, 255, 0.1);
            border: 1px solid #00d2ff;
            color: #00d2ff;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.65rem;
            width: 100%;
            font-weight: 700;
            text-transform: uppercase;
        }

        #view-toggle.active {
            background: #00d2ff;
            color: #05070c;
        }

        #controls-hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.65rem;
            pointer-events: none;
        }

        #description {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: rgba(0, 210, 255, 0.5);
            font-size: 0.6rem;
            max-width: 250px;
            text-align: right;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="ui" class="minimized">
        <div class="toggle-btn" onclick="toggleUI()">+</div>
        <div class="content-box">
            <h3>Nakshatra Explorer</h3>
            <p style="font-size: 0.65rem; color: #8b949e; margin-bottom: 8px; line-height: 1.3;">Zodiacal belt
                simulation showing the Moon's relative position.</p>

            <div class="control-group">
                <button id="view-toggle">Switch to Nakshatras</button>
            </div>

            <div style="margin-top: 10px; font-size: 0.7rem; line-height: 1.3; color: #ccc;">
                <strong style="color: #00d2ff;">Observation:</strong> The Moon moves through one Nakshatra (~13.3°)
                every day.
            </div>
        </div>
    </div>

    <div id="description">
        Interactive 3D Zodiac • Symbols & Names<br>
        Moon orbital motion: Enabled
    </div>

    <div id="controls-hint">
        Drag to Orbit • Scroll to Zoom
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

        // Get Params
        const params = new URLSearchParams(window.location.search);
        const targetRashi = (params.get('rashi') || 'Simha').split(' (')[0].trim();

        // 12 Rashis
        const rashis = [
            { name: 'Mesha', modern: 'Aries', symbol: '♈' }, { name: 'Vrishabha', modern: 'Taurus', symbol: '♉' },
            { name: 'Mithuna', modern: 'Gemini', symbol: '♊' }, { name: 'Kataka', modern: 'Cancer', symbol: '♋' },
            { name: 'Simha', modern: 'Leo', symbol: '♌' }, { name: 'Kanya', modern: 'Virgo', symbol: '♍' },
            { name: 'Tula', modern: 'Libra', symbol: '♎' }, { name: 'Vrishchika', modern: 'Scorpio', symbol: '♏' },
            { name: 'Dhanus', modern: 'Sagittarius', symbol: '♐' }, { name: 'Makara', modern: 'Capricorn', symbol: '♑' },
            { name: 'Kumbha', modern: 'Aquarius', symbol: '♒' }, { name: 'Meena', modern: 'Pisces', symbol: '♓' }
        ];

        // 27 Nakshatras
        const nakshatras = [
            "Ashwini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra", "Punarvasu", "Pushya", "Ashlesha",
            "Magha", "Purva Phalguni", "Uttara Phalguni", "Hasta", "Chitra", "Swati", "Vishakha", "Anuradha", "Jyeshtha",
            "Mula", "Purva Ashadha", "Uttara Ashadha", "Shravana", "Dhanishta", "Shatabhisha", "Purva Bhadrapada", "Uttara Bhadrapada", "Revati"
        ];

        // Scene
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x05070c, 0.0008);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
        camera.position.set(0, 150, 450);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // Space
        const starGeo = new THREE.BufferGeometry();
        const starPos = [];
        for (let i = 0; i < 10000; i++) {
            const r = 1200 * Math.random();
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos(2 * Math.random() - 1);
            starPos.push(r * Math.sin(phi) * Math.cos(theta), r * Math.sin(phi) * Math.sin(theta), r * Math.cos(phi));
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.8 });
        scene.add(new THREE.Points(starGeo, starMat));

        // Zodiac Containers
        const mainGroup = new THREE.Group();
        scene.add(mainGroup);

        const bandRadius = 250;

        // 1. Rashi Group
        const rashiGroup = new THREE.Group();
        mainGroup.add(rashiGroup);

        const bandMat = new THREE.MeshStandardMaterial({ color: 0x996633, emissive: 0x442200, transparent: true, opacity: 0.3 });
        const band = new THREE.Mesh(new THREE.TorusGeometry(bandRadius, 12, 32, 128), bandMat);
        band.rotation.x = Math.PI / 2;
        rashiGroup.add(band);

        let targetIdx = 4;
        rashis.forEach((r, i) => {
            if (r.name === targetRashi) targetIdx = i;
            const angle = (i / 12) * Math.PI * 2;
            const x = bandRadius * Math.cos(angle);
            const z = bandRadius * Math.sin(angle);

            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffcc00'; ctx.font = 'bold 200px serif'; ctx.textAlign = 'center';
            ctx.fillText(r.symbol, 256, 250);
            ctx.fillStyle = '#ffffff'; ctx.font = '40px sans-serif';
            ctx.fillText(r.name.toUpperCase(), 256, 350);

            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: new THREE.CanvasTexture(canvas) }));
            sprite.position.set(x, 25, z);
            sprite.scale.set(70, 70, 1);
            rashiGroup.add(sprite);
        });

        // 2. Nakshatra Group (Hidden by default)
        const nakshatraGroup = new THREE.Group();
        nakshatraGroup.visible = false;
        mainGroup.add(nakshatraGroup);

        const nakBandMat = new THREE.MeshStandardMaterial({ color: 0x00d2ff, emissive: 0x001122, transparent: true, opacity: 0.2 });
        const nakBand = new THREE.Mesh(new THREE.TorusGeometry(bandRadius, 8, 32, 128), nakBandMat);
        nakBand.rotation.x = Math.PI / 2;
        nakshatraGroup.add(nakBand);

        nakshatras.forEach((n, i) => {
            const angle = (i / 27) * Math.PI * 2;
            const x = bandRadius * Math.cos(angle);
            const z = bandRadius * Math.sin(angle);

            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#00d2ff'; ctx.font = 'bold 44px sans-serif'; ctx.textAlign = 'center';
            ctx.fillText(n.toUpperCase(), 256, 80);

            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: new THREE.CanvasTexture(canvas) }));
            sprite.position.set(x, 20, z);
            sprite.scale.set(60, 15, 1);
            nakshatraGroup.add(sprite);

            // Tick marks
            const tGeo = new THREE.BoxGeometry(1, 15, 1);
            const tMesh = new THREE.Mesh(tGeo, new THREE.MeshBasicMaterial({ color: 0x00d2ff }));
            tMesh.position.set(x, 0, z);
            tMesh.rotation.y = -angle;
            nakshatraGroup.add(tMesh);
        });

        // Focus Camera on Target Rashi
        mainGroup.rotation.y = - (targetIdx / 12) * Math.PI * 2 + Math.PI / 2;

        // UI Logic
        window.toggleUI = function () {
            const ui = document.getElementById('ui');
            const toggleBtn = ui.querySelector('.toggle-btn');
            if (ui.classList.contains('minimized')) {
                ui.classList.remove('minimized');
                toggleBtn.textContent = '−';
            } else {
                ui.classList.add('minimized');
                toggleBtn.textContent = '+';
            }
        }

        const viewToggle = document.getElementById('view-toggle');
        viewToggle.onclick = () => {
            const isNak = nakshatraGroup.visible;
            nakshatraGroup.visible = !isNak;
            rashiGroup.visible = isNak;
            viewToggle.classList.toggle('active');
            viewToggle.innerText = isNak ? "Switch to Nakshatras" : "Switch to 12 Rashis";
        };

        // Moon
        const moonGroup = new THREE.Group();
        moonGroup.rotation.x = 0.1; // tilt
        scene.add(moonGroup);
        const moon = new THREE.Mesh(new THREE.SphereGeometry(15, 32, 32), new THREE.MeshStandardMaterial({ color: 0xcccccc }));
        moon.position.set(0, 40, 150);
        moonGroup.add(moon);

        // Lighting
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(100, 200, 100);
        scene.add(dirLight);

        // Animate
        let moonAngle = 0;
        function animate() {
            requestAnimationFrame(animate);
            mainGroup.rotation.y += 0.0002;
            moonAngle += 0.002;
            moon.position.x = 100 * Math.cos(moonAngle);
            moon.position.z = 150 + 50 * Math.sin(moonAngle);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>