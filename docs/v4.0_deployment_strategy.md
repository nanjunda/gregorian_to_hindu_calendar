# v4.0 Cosmic Context Deployment Strategy (Oracle Linux 9)

## Overview
This document outlines the deployment strategy for the Hindu Panchanga Converter v4.0. It follows the security and architectural principles established in v3.2.1, specifically targeting Oracle Linux 9 on Oracle Cloud (OCI).

## Core Principles (v3.2.1 Heritage)
The v4.0 deployment maintains the following security and hardening standards:
1. **HTTPS Everywhere**: All traffic is encrypted using OpenSSL-generated self-signed certificates.
2. **Obfuscated Port (58921)**: Nginx listens on a custom high port (58921) as a security measure.
3. **Application Relocation**: To bypass SELinux home directory restrictions on Oracle Linux 9, the application is deployed to `/opt/panchanga`.
4. **Log Security**: Hourly log rotation is configured for both Nginx and Gunicorn.

## Security & Maintenance
- **Port 58921**: Ensure that the Oracle Cloud Security List (Ingress Rules) for your VCN allows TCP traffic on Port 58921.
- **Log Rotation**: Logs are automatically rotated hourly via the script settings in `/etc/logrotate.d/panchanga`.
- **Privacy (Stealth Mode)**: Birth images are served via **Base64 encoding** (no public URLs). Direct access to folders is blocked.
- **Privacy (Auto-Cleanup)**: All birth-chart images are automatically deleted after **15 minutes** via a cron job (`/etc/cron.d/panchanga-cleanup`).

## Deployment Workflow
The deployment is automated via `deploy.sh` and follows this sequence:
1. **Source Retrieval**: `git clone` of the `cosmic` branch.
2. **Environment Setup**: Creation of a clean Python 3 virtual environment in `/opt/panchanga`.
3. **Security Configuration**:
   - Generate self-signed SSL certificates.
   - Configure Nginx with Port 58921.
   - Configure Firewall and SELinux contexts.
4. **Service Orchestration**: Systemd service management for Gunicorn.

## Success Metrics
- Application reachable only via `https://[IP]:58921`.
- Visual components (Sky-Shot and Solar System) render and cache correctly.
- SSL termination successful with self-signed certificate.
