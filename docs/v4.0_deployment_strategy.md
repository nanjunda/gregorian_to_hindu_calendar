# v4.0 Cosmic Context Deployment Strategy (Oracle Linux 9)

## Overview
This document outlines the deployment strategy for the Hindu Panchanga Converter v4.0. It follows the security and architectural principles established in v3.2.1, specifically targeting Oracle Linux 9 on Oracle Cloud (OCI).

## Core Principles (v3.2.1 Heritage)
The v4.0 deployment maintains the following security and hardening standards:
1. **HTTPS Everywhere**: All traffic is encrypted using OpenSSL-generated self-signed certificates.
2. **Obfuscated Port (58921)**: Nginx listens on a custom high port (58921) as a security measure.
3. **Application Relocation**: To bypass SELinux home directory restrictions on Oracle Linux 9, the application is deployed to `/opt/panchanga`.
4. **Log Security**: Hourly log rotation is configured for both Nginx and Gunicorn.

## v4.0 Specific Requirements
1. **New Dependencies**: The "Cosmic Context" features introduce `matplotlib` and `skyfield` as core dependencies.
2. **Static Asset Caching**: 
   - `static/skyshots/`: Cached 2D sky maps.
   - `static/solar_systems/`: Cached planetary alignment views.
3. **SELinux Hardening**: Nginx must be granted explicit read permissions for these new subdirectories via the `httpd_sys_content_t` context.
4. **fapolicyd Management**: As with v3.2.1, `fapolicyd` must be managed to allow execution of non-RPM binaries (pip/venv packages).

## Deployment Workflow
The deployment is automated via `deploy.sh` and follows this sequence:
1. **Source Retrieval**: `git clone` of the `cosmic` branch.
2. **Environment Setup**: Creation of a clean Python 3 virtual environment in `/opt/panchanga`.
3. **Security Configuration**:
   - Generate self-signed SSL certificates.
   - Configure Nginx with Port 58921.
   - Configure Firewall and SELinux contexts.
4. **Service Orchestration**: Systemd service management for Gunicorn.

## Success Metrics
- Application reachable only via `https://[IP]:58921`.
- Visual components (Sky-Shot and Solar System) render and cache correctly.
- SSL termination successful with self-signed certificate.
